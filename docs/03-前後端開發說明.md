# 前後端開發說明

## 開發環境準備

### 必要軟體
1. **Node.js** (版本 18+)
2. **npm** (通常與 Node.js 一起安裝)
3. **Git**
4. **VS Code** (推薦的編輯器)

### 專案初始化
```bash
# 複製專案
git clone <repository-url>
cd GDG-Portal

# 安裝所有依賴 (根目錄、前端、後端)
npm run install:all
```

## 前端開發 (React)

### 目錄結構說明
```
client/src/
├── components/        # React 組件
│   ├── main/         # 主頁相關組件
│   ├── event/        # 活動相關組件  
│   ├── member/       # 成員相關組件
│   ├── profile/      # 個人檔案組件
│   └── general/      # 通用組件 (Button, Modal 等)
├── hooks/            # 自定義 Hook
├── pages/            # 頁面級組件
├── services/         # API 呼叫服務
├── utils/            # 工具函數
└── data/             # 靜態資料和模擬資料
```

### 開發流程

#### 1. 啟動開發伺服器
```bash
# 僅啟動前端 (Vite 開發伺服器)
npm run dev:client

# 或同時啟動前後端
npm run dev
```

#### 2. 創建新組件
```javascript
// client/src/components/example/ExampleComponent.jsx
import React from 'react';

const ExampleComponent = ({ title, children }) => {
  return (
    <div className="example-component">
      <h2>{title}</h2>
      {children}
    </div>
  );
};

export default ExampleComponent;
```

#### 3. 使用自定義 Hook 管理狀態
```javascript
// client/src/hooks/useExampleData.js
import { useState, useEffect } from 'react';

export const useExampleData = () => {
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    setLoading(true);
    try {
      const response = await fetch('/api/example');
      const result = await response.json();
      setData(result);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  return { data, loading, error, refetch: fetchData };
};
```

#### 4. API 服務層
```javascript
// client/src/services/apiService.js
const API_BASE = '/api';

export const apiService = {
  // GET 請求
  async get(endpoint) {
    const response = await fetch(`${API_BASE}${endpoint}`);
    if (!response.ok) throw new Error('請求失敗');
    return response.json();
  },

  // POST 請求
  async post(endpoint, data) {
    const response = await fetch(`${API_BASE}${endpoint}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    if (!response.ok) throw new Error('請求失敗');
    return response.json();
  }
};
```

### 樣式開發 (Tailwind CSS)
```javascript
// 使用 Tailwind CSS 類別
<div className="bg-blue-500 text-white p-4 rounded-lg shadow-md">
  <h2 className="text-xl font-bold mb-2">標題</h2>
  <p className="text-sm opacity-90">內容文字</p>
</div>
```

## 後端開發 (Node.js + Express)

### 目錄結構說明
```
server/
├── controllers/      # 控制器 (業務邏輯)
├── routes/          # 路由定義
├── model/           # 資料模型 (Sequelize)
├── middlewares/     # 中間件
├── config/          # 配置文件
├── utils/           # 工具函數
└── scripts/         # 資料庫腳本
```

### 開發流程

#### 1. 啟動開發伺服器
```bash
# 僅啟動後端
npm run dev:server

# 或同時啟動前後端
npm run dev
```

#### 2. 創建新的 API 端點

**步驟 1：定義路由**
```javascript
// server/routes/exampleRoutes.js
const express = require('express');
const router = express.Router();
const exampleController = require('../controllers/exampleController');

router.get('/', exampleController.getAll);
router.get('/:id', exampleController.getById);
router.post('/', exampleController.create);
router.put('/:id', exampleController.update);
router.delete('/:id', exampleController.delete);

module.exports = router;
```

**步驟 2：實作控制器**
```javascript
// server/controllers/exampleController.js
const { Example } = require('../model');

const exampleController = {
  // 取得所有資料
  async getAll(req, res) {
    try {
      const examples = await Example.findAll();
      res.json(examples);
    } catch (error) {
      res.status(500).json({ error: error.message });
    }
  },

  // 取得單筆資料
  async getById(req, res) {
    try {
      const example = await Example.findByPk(req.params.id);
      if (!example) {
        return res.status(404).json({ error: '找不到資料' });
      }
      res.json(example);
    } catch (error) {
      res.status(500).json({ error: error.message });
    }
  },

  // 創建新資料
  async create(req, res) {
    try {
      const example = await Example.create(req.body);
      res.status(201).json(example);
    } catch (error) {
      res.status(400).json({ error: error.message });
    }
  }
};

module.exports = exampleController;
```

**步驟 3：註冊路由**
```javascript
// server/index.js
const exampleRoutes = require('./routes/exampleRoutes');
app.use('/api/example', exampleRoutes);
```

#### 3. 創建資料模型
```javascript
// server/model/exampleModel.js
const { DataTypes } = require('sequelize');

module.exports = (sequelize) => {
  const Example = sequelize.define('Example', {
    id: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    title: {
      type: DataTypes.STRING,
      allowNull: false,
      validate: {
        notEmpty: true,
        len: [1, 255]
      }
    },
    description: {
      type: DataTypes.TEXT,
      allowNull: true
    },
    created_at: {
      type: DataTypes.DATE,
      defaultValue: DataTypes.NOW
    }
  }, {
    tableName: 'examples',
    underscored: true,  // 使用 snake_case
    timestamps: true
  });

  return Example;
};
```

### 中間件開發
```javascript
// server/middlewares/validation.js
const validateExample = (req, res, next) => {
  const { title } = req.body;
  
  if (!title || title.trim().length === 0) {
    return res.status(400).json({ 
      error: '標題為必填欄位' 
    });
  }
  
  if (title.length > 255) {
    return res.status(400).json({ 
      error: '標題長度不能超過 255 字元' 
    });
  }
  
  next();
};

module.exports = { validateExample };
```

## 資料庫操作

### 常用 Sequelize 方法
```javascript
// 查詢所有
const users = await User.findAll();

// 條件查詢
const activeUsers = await User.findAll({
  where: { status: 'active' }
});

// 關聯查詢
const userWithProfile = await User.findAll({
  include: [{ model: Profile }]
});

// 分頁查詢
const users = await User.findAndCountAll({
  limit: 10,
  offset: 0,
  order: [['created_at', 'DESC']]
});

// 新增
const newUser = await User.create({
  name: '新使用者',
  email: 'user@example.com'
});

// 更新
await User.update(
  { name: '更新的名字' },
  { where: { id: 1 } }
);

// 刪除
await User.destroy({
  where: { id: 1 }
});
```

## 除錯技巧

### 前端除錯
1. **瀏覽器開發者工具**
   - Console：查看錯誤訊息和 log
   - Network：檢查 API 請求和回應
   - React DevTools：檢查組件狀態

2. **常用除錯指令**
```javascript
console.log('變數值:', variable);
console.error('錯誤:', error);
console.table(arrayData);  // 表格形式顯示陣列
```

### 後端除錯
1. **伺服器日誌**
```javascript
// 在控制器中加入日誌
console.log('收到請求:', req.method, req.path);
console.log('請求內容:', req.body);
```

2. **資料庫查詢日誌**
```javascript
// 在 database.js 中開啟 SQL 日誌
const sequelize = new Sequelize(database, username, password, {
  host: host,
  dialect: 'mysql',
  logging: console.log,  // 顯示 SQL 查詢
});
```

## 常見問題解決

### CORS 問題
```javascript
// server/index.js
const cors = require('cors');
app.use(cors({
  origin: 'http://localhost:5173',  // 前端開發伺服器地址
  credentials: true
}));
```

### 環境變數問題
```javascript
// 確保載入 .env 檔案
require('dotenv').config();

// 使用環境變數
const dbHost = process.env.DB_HOST || 'localhost';
```

### 檔案上傳問題
```javascript
// 檢查上傳目錄是否存在
const fs = require('fs');
const uploadDir = './public/uploads';
if (!fs.existsSync(uploadDir)) {
  fs.mkdirSync(uploadDir, { recursive: true });
}
```

## 開發最佳實踐

1. **命名規範**
   - 檔案名：kebab-case (example-component.jsx)
   - 變數名：camelCase (userName)
   - 常數：UPPER_CASE (API_BASE_URL)

2. **錯誤處理**
   - 總是使用 try-catch 包裝異步操作
   - 提供有意義的錯誤訊息
   - 記錄錯誤以便除錯

3. **代碼組織**
   - 保持函數簡短和單一職責
   - 使用有意義的變數和函數名稱
   - 適當添加註解說明複雜邏輯

4. **效能考量**
   - 避免在組件中進行昂貴的計算
   - 使用 React.memo() 避免不必要的重新渲染
   - 實作分頁以避免一次載入太多資料
