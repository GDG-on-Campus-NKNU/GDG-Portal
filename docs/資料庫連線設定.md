# 透過 ZeroTier 連接資料庫

## 1. 簡介

本文件旨在說明如何將您的本地開發環境連接至專案的資料庫。由於資料庫位於私有網路中，必須透過 ZeroTier 虛擬網路才能存取。您需要先加入指定的 ZeroTier 網路，以取得允許連接資料庫的內部 IP 位址，本專案資料庫24小時不間斷運作。


## 2. 前置準備

開始之前，請確保您已具備以下條件：
(以下所述之管理員為@lin0813you)
* **ZeroTier 網路 ID:** 您需要專案所使用的特定 ZeroTier 網路 ID。請向管理員索取。
* **資料庫憑證:**
    * **主機:** 資料庫伺服器在 **ZeroTier 網路內的** 內部 IP 位址。這 **不是** 公開 IP。請向管理員索取。我們將其稱為 `[資料庫_主機_IP_ZEROTIER]`。
    * **連接埠:** 資料庫正在監聽的連接埠號碼（例如 PostgreSQL 的 `5432`，MySQL 的 `3306`）。我們將其稱為 `[資料庫_連接埠]`。
    * **使用者名稱:** 您的資料庫使用者名稱。我們將其稱為 `[資料庫_使用者]`。
    * **密碼:** 您的資料庫密碼。我們將其稱為 `[資料庫_密碼]`。
    * **資料庫名稱:** 您需要連接的資料庫名稱。我們將其稱為 `[資料庫_名稱]`。
* **管理員核准:** 加入 ZeroTier 網路需要管理員的核准。

## 3. 步驟一：設定 ZeroTier

### 3.1 ZeroTier 是什麼？

ZeroTier 是一套軟體定義網路 (SDN) 解決方案，可以讓分散各地的機器透過點對點虛擬網路安全連線，就像在同一個局域網 (LAN) 中。  
透過 ZeroTier，開發者可將本機納入專案私有網路 (Virtual LAN)，再利用該虛擬 LAN IP 連接資料庫，避免將資料庫暴露於公網。

### 3.2 下載與安裝 ZeroTier

1.  前往 ZeroTier 官方網站： [https://www.zerotier.com/download/](https://www.zerotier.com/download/)
2.  下載適用於您作業系統（Windows、macOS、Linux）的安裝程式。
3.  執行安裝程式並依照螢幕上的指示操作。

### 3.3 加入專案網路

1.  **開啟 ZeroTier 應用程式：** 在 Windows 的系統匣或 macOS 的選單列找到 ZeroTier 圖示，點擊它並選擇「加入網路...」(Join Network...)。
2.  **輸入網路 ID：** 將您取得的 `[您的_ZEROTIER_網路_ID]` 貼到輸入欄位中，然後點擊「加入」(Join)。

### 3.4 等待授權

* 在您嘗試加入後，您的裝置需要被 ZeroTier 管理員授權。
* 您可能需要將您的 **ZeroTier 位址**（一個分配給您客戶端的獨特 10 位元十六進位 ID，可在 ZeroTier 圖形介面中查看）提供給管理員。
* 等待確認您的裝置已被授權。

### 3.5 驗證連線

* 一旦獲得授權，再次檢查 ZeroTier 應用程式。
* 網路狀態應變為 `OK`（或類似狀態），並且您應該會看到一個在 ZeroTier 網路範圍內的 IP 位址被分配給您（例如 `10.x.x.x`、`192.168.x.x` - 取決於網路設定）。這確認您已成功連接到虛擬網路。

## 4. 步驟二：在 Node.js 中設定資料庫連線

既然您已是 ZeroTier 網路的一部分，您可以設定您的 Node.js 應用程式，使用其內部 IP 位址來連接資料庫。



1.  在您的 Node.js 專案中找到資料庫設定檔（ `.env` 檔案）。
2.  確保您使用的是在前置準備階段取得的正確資料庫連線參數：
    * `host`: `[資料庫_主機_IP_ZEROTIER]` (透過 ZeroTier 可存取的內部 IP)
    * `port`: `[資料庫_連接埠]`
    * `user`: `[資料庫_使用者]`
    * `password`: `[資料庫_密碼]`
    * `database`: `[資料庫_名稱]`

## 5. 步驟三：驗證應用程式連線

1.  確保 ZeroTier 正在運行並已連接到正確的網路 (`[您的_ZEROTIER_網路_ID]`)。
2.  啟動您的 Node.js 應用程式 
3.  檢查應用程式日誌。 尋找指示資料庫連線成功的訊息（如先前範例中的「已成功連接...」訊息）或任何連線錯誤。


## 6. 問題排解

* **無法加入 ZeroTier 網路：**
    * 再次檢查 `[您的_ZEROTIER_網路_ID]` 是否正確。
    * 向管理員確認是否需要授權，以及您的裝置是否已獲批准。
    * 檢查您的網際網路連線。
* **已加入 ZeroTier，但無法連接資料庫：**
    * 確認 ZeroTier 顯示網路狀態為 `OK` 且您已取得分配的 IP 位址。
    * 確認您在應用程式設定中使用了正確的 `[資料庫_主機_IP_ZEROTIER]` 和 `[資料庫_連接埠]`。**此 IP 僅在 ZeroTier 啟用並連接時才能存取。**
    * 檢查您的資料庫憑證 (`[資料庫_使用者]`, `[資料庫_密碼]`, `[資料庫_名稱]`)。

    * 檢查您機器和資料庫伺服器上的防火牆規則。伺服器的防火牆必須允許來自 ZeroTier IP 範圍在指定 `[資料庫_連接埠]` 上的連線。
    * 當 ZeroTier 連接時，嘗試從您的機器終端機 `` `ping` `` `[資料庫_主機_IP_ZEROTIER]`。如果沒有回應，可能存在網路設定或防火牆問題。
* **連線緩慢：**
    * 相較於直接的本地連線，透過虛擬網路的網路延遲可能會更高。這在某種程度上是預期的。

如果您遇到持續無法解決的問題，請聯繫ZeroTier網路與資料庫的管理員@lin0813you。
